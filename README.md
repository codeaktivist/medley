# medley

Pick a folder with wav audio files and let this C program merge all tracks into a medley.

## Video Demo
tbd

## Description

A medley lets you enjoy the best parts of a few songs (very often three) in one peace. Wouldn't it be nice to have a medley for every album you wanted to listen to? ... to know what it sounds like? ... to remember it by?
This little tools grabs a part of every audio track it finds and merges them into a new audio file, blending the edits with a crossfade to your liking ... and there is your smooth medley :)

## How to install

Download the distribution from here or type:\
```wget https://github.com/codeaktivist/medley/archive/refs/tags/v1.0.0.zip```

Unzip the distribution zip file:\
```unzip v1.0.0.zip```

Compile from source using make or your own favorite compiler:\
```make medley```

Run the program:\
```./medley dir-with-songs/```

## Usage

To generate your medley, the program needs some info:

- **location** of the folder containing the audio files
- name of your medley **file**, including the file type .wav
- **in-marker** in seconds from beginning of each audio track
- **duration** of the part you want to add to your medley
- length of the **crossfade** between each of the parts

### Parameters and defaults

Parameters are optional. If not specified via the respective flag, default values are used:

| Parameter | Flag | Default | Description |
|-|-|-|-|
| location | -r | audio | **r**ead source directory |
|file|-w|medley.wav|**w**rite to output file|
|in|-i|1|**i**n-marker in seconds|
|dur|-d|2|**d**uration in seconds|
|x-fade|-x|0.5|**x**fade duration in seconds|

### Examples

```./medley -r /beatles -w beatles.wav -i 40 -d 10 -x 1```
Take all wav files in the folder beatles and create the medley beatles.wav with 10 Seconds (0:40 to 0:50) from each song using 1 second to blend between them.

```./medley /slipknot -i 0 -d 10 -x 0```
Take any .wav file in the slipknot folder and generate a medley.wav made up of the first 10 seconds of every song.

```./medley /coldplay -f elevator.wav -i 40 -d 20 -x 10```
Produce some everblending elevator music ;P

### Remarks

The length specified for the crossfade will also be used for the fade in (first track) and the fade out (last track).

Explicitly setting the crossfade duration to 0 will result in a hard and audible cut. A minimum length of 0.1 is recommended (100ms).

The crossfade cannot be longer than the part or the actual song, so a 5 second crossfade on a 8 second part will result in an error.

### Limitations

tl;dr: Use 16 bit standard wave files, mono or stereo

- Only uncompressed wave files are supported (.wav, .wave, .bwf). Other files will be ignored.
- Only mono and stereo files are supported. All files must have the same number of channel, so no downmix or summing involved.
- All files must have the same sample frequency (e.g. 44.1kHz, 48kHz). Sorry, no sample rate conversion.
- Only 16 bit files are supported. No interpolation or dithering is happening, so other bit depth (e.g. 8, 24) or floating point files will be ignored.


---
## Under the hood

1. I read all files from the input directory (-i) with opendir to preflight the data: Check for valid file type, ignore invalid files, store valid files in Track struct, arranging all Tracks in a doubly linked list, sorting the list by ascending order => Playlist
2. All potential audio files are now read and analyzed by retrieving their RIFF, format and data chunk. The first valid track sets the default for the medley: Mono or Stereo, 44.1 or 48 kHz, etc. All other tracks are matched against the default any may ot may not be added to the output file. The result is printed to the screen.
3. The medley file is generated by writing the RIFF chunk and format chunk first (meta data). The audio data is written by cycling thru the playlist (via file pointers), adjusting level (fade in, fade out) and mixing with the next track (crossfade) as needed.
4. Files for reading and writing are then closed and the playlist gets deleted, freeing all allocated memory.

## Return codes / error codes

0: Success\
1: Wrong user input\
2: Failed to allocate memory\
3: File not found\
4: Error or file corruption in read\
5: Error or file corruption in write\

Feel free to try, fork, improve :heart: